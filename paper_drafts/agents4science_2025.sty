% Partial rewrite of the LaTeX2e package for submissions to the
% Open Conference of AI Agents for Science (agents4science):
%
% - Based on the NeurIPS 2025 style file by Roman Garnett et al.
% - Style modified for visual distinction (e.g., title rule)
% - Conference name, year, and details updated
% - Track options simplified for a general conference
%
% Last revision: July 2025

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{agents4science_2025}[2025/07/22 agents4science 2025 submission/camera-ready style file]

% declare final option, which creates camera-ready copy
\newif\if@agentsfinal\@agentsfinalfalse
\DeclareOption{final}{
  \@agentsfinaltrue
  \@anonymousfalse
}

% declare nonatbib option, which does not load natbib in case of
% package clash (users can pass options to natbib via
% \PassOptionsToPackage)
\newif\if@natbib\@natbibtrue
\DeclareOption{nonatbib}{
  \@natbibfalse
}

% declare preprint option, which creates a preprint version ready for
% upload to, e.g., arXiv
\newif\if@preprint\@preprintfalse
\DeclareOption{preprint}{
  \@preprinttrue
  \@anonymousfalse
}

% determine the track of the paper in camera-ready mode
\newif\if@main\@maintrue
\DeclareOption{main}{
  \@maintrue
  \newcommand{\@trackname}{\@agentsordinal\ Open Conference of AI Agents for Science (agents4science \@agentsyear).}
}

% For anonymous or non-anonymous
\newif\if@anonymous\@anonymoustrue

% For workshop papers
\newcommand{\@workshoptitle}{}
\newcommand{\workshoptitle}[1]{\renewcommand{\@workshoptitle}{#1}}

\ProcessOptions\relax

% fonts
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}

% change this every year for notice string at bottom
\newcommand{\@agentsordinal}{1st}
\newcommand{\@agentsyear}{2025}
\newcommand{\@agentslocation}{Stanford, CA}

% acknowledge package
\RequirePackage{environ}
\newcommand{\acklabel}{Acknowledgments and Disclosure of Funding}
\NewEnviron{ack}{%
  \if@anonymous\relax\else%
    \section*{\acklabel}%
    \BODY%
  \fi%
}

% handle tweaks for camera-ready copy vs. submission copy
\if@preprint
  \newcommand{\@noticestring}{%
    Preprint. Under review.%
  }
\else
  \if@agentsfinal
    \newcommand{\@noticestring}{%
      \@agentsordinal\ Open Conference of AI Agents for Science (agents4science \@agentsyear), \@agentslocation.%
    }
  \else
    \newcommand{\@noticestring}{%
      Submitted to \@agentsordinal\ Open Conference of AI Agents for Science (agents4science \@agentsyear). Do not distribute.%
    }
    % add line numbers for submission
    \RequirePackage[right]{lineno}
    \linenumbers
  \fi
\fi

% load natbib unless told not to
\if@natbib
  \RequirePackage{natbib}
\fi

% set page geometry
\RequirePackage[verbose=true,letterpaper]{geometry}
\AtBeginDocument{
  \newgeometry{
    textheight=9in,
    textwidth=5.5in,
    top=1in,
    headheight=12pt,
    headsep=25pt,
    footskip=30pt
  }
  \@ifpackageloaded{fullpage}
    {\PackageError{agents4science_2025}{fullpage package not allowed! Complain to the authors.}}
    {}
}

\widowpenalty=10000
\clubpenalty=10000
\flushbottom
\sloppy

% font sizes with reduced leading
\renewcommand{\normalsize}{%
  \@setfontsize\normalsize\@xpt\@xipt
  \abovedisplayskip      7\p@ \@plus 2\p@ \@minus 5\p@
  \abovedisplayshortskip \z@ \@plus 3\p@
  \belowdisplayskip      \abovedisplayskip
  \belowdisplayshortskip 4\p@ \@plus 3\p@ \@minus 3\p@
}
\normalsize
\renewcommand{\small}{%
  \@setfontsize\small\@ixpt\@xpt
  \abovedisplayskip      6\p@ \@plus 1.5\p@ \@minus 4\p@
  \abovedisplayshortskip \z@  \@plus 2\p@
  \belowdisplayskip      \abovedisplayskip
  \belowdisplayshortskip 3\p@ \@plus 2\p@   \@minus 2\p@
}
\renewcommand{\footnotesize}{%
  \@setfontsize\footnotesize\@viiipt{9.5pt}
  \abovedisplayskip      6\p@ \@plus 1.5\p@ \@minus 4\p@
  \abovedisplayshortskip \z@  \@plus \p@
  \belowdisplayskip      \abovedisplayskip
  \belowdisplayshortskip 3\p@ \@plus \p@    \@minus 2\p@
}

% sections with less space
\def\section{\@startsection{section}{1}{\z@}%
                           {-2.5ex \@plus -0.5ex \@minus -0.2ex}%
                           {1.3ex \@plus 0.2ex}%
                           {\large\bf\raggedright}}

\def\subsection{\@startsection{subsection}{2}{\z@}%
                               {-2.25ex \@plus -0.5ex \@minus -0.2ex}%
                               {1ex \@plus 0.2ex}%
                               {\normalsize\bf\raggedright}}
\def\subsubsection{\@startsection{subsubsection}{3}{\z@}%
                                 {-1.5ex \@plus -0.5ex \@minus -0.2ex}%
                                 {0.75ex \@plus 0.2ex}%
                                 {\normalsize\bf\raggedright}}
\def\paragraph{\@startsection{paragraph}{4}{\z@}%
                              {1.5ex \@plus 0.5ex \@minus 0.2ex}%
                              {-1em}%
                              {\normalsize\bf}}
\def\subparagraph{\@startsection{subparagraph}{5}{\z@}%
                                 {1.5ex \@plus 0.5ex \@minus 0.2ex}%
                                 {-1em}%
                                 {\normalsize\bf}}
\def\subsubsubsection{\@startsection{subsubsubsection}{6}{\z@}%
                                     {1.5ex \@plus 0.5ex \@minus 0.2ex}%
                                     {-1em}%
                                     {\normalsize\bf}}

% float placement
\renewcommand{\topfraction      }{0.85}
\renewcommand{\bottomfraction   }{0.4}
\renewcommand{\textfraction     }{0.1}
\renewcommand{\floatpagefraction}{0.7}

\newlength{\@agentsabovecaptionskip}\setlength{\@agentsabovecaptionskip}{7\p@}
\newlength{\@agentsbelowcaptionskip}\setlength{\@agentsbelowcaptionskip}{\z@}

\setlength{\abovecaptionskip}{\@agentsabovecaptionskip}
\setlength{\belowcaptionskip}{\@agentsbelowcaptionskip}

% swap above/below caption skips for tables
\renewcommand{\table}[1][tbp]{\@float{table}[#1]%
\setlength{\abovecaptionskip}{\@agentsbelowcaptionskip}%
\setlength{\belowcaptionskip}{\@agentsabovecaptionskip}%
}
\let\endtable\end@float

% footnote formatting
\setlength{\footnotesep }{6.65\p@}
\setlength{\skip\footins}{9\p@ \@plus 4\p@ \@minus 2\p@}
\renewcommand{\footnoterule}{\kern-3\p@ \hrule width 12pc \kern 2.6\p@}
\setcounter{footnote}{0}

% paragraph formatting
\setlength{\parindent}{\z@}
\setlength{\parskip  }{5.5\p@}

% list formatting
\setlength{\topsep       }{4\p@ \@plus 1\p@   \@minus 2\p@}
\setlength{\partopsep    }{1\p@ \@plus 0.5\p@ \@minus 0.5\p@}
\setlength{\itemsep      }{2\p@ \@plus 1\p@   \@minus 0.5\p@}
\setlength{\parsep       }{2\p@ \@plus 1\p@   \@minus 0.5\p@}
\setlength{\leftmargin   }{3pc}
\setlength{\leftmargini  }{\leftmargin}
\setlength{\leftmarginii }{2em}
\setlength{\leftmarginiii}{1.5em}
\setlength{\leftmarginiv }{1.0em}
\setlength{\leftmarginv  }{0.5em}
\def\@listi  {\leftmargin\leftmargini}
\def\@listii {\leftmargin\leftmarginii
              \labelwidth\leftmarginii
              \advance\labelwidth-\labelsep
              \topsep  2\p@ \@plus 1\p@    \@minus 0.5\p@
              \parsep  1\p@ \@plus 0.5\p@ \@minus 0.5\p@
              \itemsep \parsep}
\def\@listiii{\leftmargin\leftmarginiii
              \labelwidth\leftmarginiii
              \advance\labelwidth-\labelsep
              \topsep    1\p@ \@plus 0.5\p@ \@minus 0.5\p@
              \parsep    \z@
              \partopsep 0.5\p@ \@plus 0\p@ \@minus 0.5\p@
              \itemsep   \topsep}
\def\@listiv {\leftmargin\leftmarginiv
              \labelwidth\leftmarginiv
              \advance\labelwidth-\labelsep}
\def\@listv  {\leftmargin\leftmarginv
              \labelwidth\leftmarginv
              \advance\labelwidth-\labelsep}
\def\@listvi {\leftmargin\leftmarginvi
              \labelwidth\leftmarginvi
              \advance\labelwidth-\labelsep}

% create title
\providecommand{\maketitle}{}
\renewcommand{\maketitle}{%
  \par
  \begingroup
    \renewcommand{\thefootnote}{\fnsymbol{footnote}}
    % for perfect author name centering
    \renewcommand{\@makefnmark}{\hbox to \z@{$^{\@thefnmark}$\hss}}
    % The footnote-mark was overlapping the footnote-text,
    % added the following to fix this problem          (MK)
    \long\def\@makefntext##1{%
      \parindent 1em\noindent
      \hbox to 1.8em{\hss $\m@th ^{\@thefnmark}$}##1
    }
    \thispagestyle{empty}
    \@maketitle
    \@thanks
    \@notice
  \endgroup
  \let\maketitle\relax
  \let\thanks\relax
}

% rules for title box at top of first page
\newcommand{\@toptitlebar}{
  \hrule height 2\p@
  \vskip 0.25in
  \vskip -\parskip%
}
\newcommand{\@bottomtitlebar}{
  \vskip 0.29in
  \vskip -\parskip
  \hrule height 2\p@
  \vskip 0.09in%
}

% create title (includes both anonymized and non-anonymized versions)
\providecommand{\@maketitle}{}
\renewcommand{\@maketitle}{%
  \vbox{%
    \hsize\textwidth
    \linewidth\hsize
    \vskip 0.1in
    \@toptitlebar
    \centering
    {\LARGE\bf \@title\par}
    \@bottomtitlebar
    \if@anonymous
      \vskip 0.05in
      {\large\bf Anonymous Author(s) \\
       Affiliation not available \\
       email not available}
    \else
      \def\And{%
        \end{tabular}\hfil\linebreak[0]\hfil%
        \begin{tabular}[t]{c}\bf\rule{\z@}{24\p@}\ignorespaces%
      }
      \def\AND{%
        \end{tabular}\hfil\linebreak[4]\hfil%
        \begin{tabular}[t]{c}\bf\rule{\z@}{24\p@}\ignorespaces%
      }
      \begin{tabular}[t]{c}\bf\rule{\z@}{24\p@}\@author\end{tabular}%
    \fi
    \vskip 0.3in \@minus 0.1in
  }
}

% add conference notice to bottom of page
\newcommand{\ftype@noticebox}{8}
\newcommand{\@notice}{%
  \@float{noticebox}[b]
  \footnotesize\@noticestring%
  \end@float
}

% abstract styling
\renewenvironment{abstract}%
{%
  \vskip 0.075in%
  \centerline%
  {\large\bf Abstract}%
  \vspace{0.5ex}%
  \begin{quote}%
}
{
  \par%
  \end{quote}%
  \vskip 1ex%
}

% handling of and formatting of multiple authors via \and and \And
\renewcommand{\and}{, }
\renewcommand{\And}{\end{tabular}\hfil\linebreak[0]\hfil%
                    \begin{tabular}[t]{c}\bf\rule{\z@}{24\p@}\ignorespaces}

\endinput